#include "poly_min_max.hpp"

#define BOOST_TEST_MODULE PolyMinMaxTests
#include <boost/test/unit_test.hpp>

#include <time.h>

BOOST_AUTO_TEST_CASE(TestDegree0)
{
	std::vector<mpfr::mpreal> coeffs;
	coeffs.push_back(1.0);
	
	std::pair<mpfr::mpreal,mpfr::mpreal> yy=flopoco::random::PolyMinMax(coeffs, mpfr::mpreal(0), mpfr::mpreal(1));
	
	BOOST_CHECK(yy.first==1);
	BOOST_CHECK(yy.second==1);
}

BOOST_AUTO_TEST_CASE(TestDegree1)
{
	std::vector<mpfr::mpreal> coeffs;
	
	coeffs.push_back(1.0);
	coeffs.push_back(0.0);
	std::pair<mpfr::mpreal,mpfr::mpreal> yy=flopoco::random::PolyMinMax(coeffs, mpfr::mpreal(0), mpfr::mpreal(1));
	BOOST_CHECK(yy.first==1);
	BOOST_CHECK(yy.second==1);
	
	coeffs.clear();
	coeffs.push_back(-1.0);
	coeffs.push_back(2.0);
	yy=flopoco::random::PolyMinMax(coeffs, mpfr::mpreal(0), mpfr::mpreal(1));
	BOOST_CHECK(yy.first==-1);
	BOOST_CHECK(yy.second==1);
	
	coeffs.clear();
	coeffs.push_back(0.0);
	coeffs.push_back(-1.0);
	yy=flopoco::random::PolyMinMax(coeffs, mpfr::mpreal(-1), mpfr::mpreal(1));
	BOOST_CHECK(yy.first==-1);
	BOOST_CHECK(yy.second==1);
}

BOOST_AUTO_TEST_CASE(TestDegree2)
{
	std::vector<mpfr::mpreal> coeffs;
	
	coeffs.push_back(1.0);
	coeffs.push_back(0.0);
	coeffs.push_back(0.0);
	std::pair<mpfr::mpreal,mpfr::mpreal> yy=flopoco::random::PolyMinMax(coeffs, mpfr::mpreal(0), mpfr::mpreal(1));
	BOOST_CHECK(yy.first==1);
	BOOST_CHECK(yy.second==1);
	
	coeffs.clear();
	coeffs.push_back(-1.0);
	coeffs.push_back(2.0);
	coeffs.push_back(0.0);
	yy=flopoco::random::PolyMinMax(coeffs, mpfr::mpreal(0), mpfr::mpreal(1));
	BOOST_CHECK(yy.first==-1);
	BOOST_CHECK(yy.second==1);
	
	coeffs.clear();
	coeffs.push_back(-1.0);
	coeffs.push_back(2.0);
	coeffs.push_back(0.0);
	yy=flopoco::random::PolyMinMax(coeffs, mpfr::mpreal(0), mpfr::mpreal(1));
	BOOST_CHECK(yy.first==-1);
	BOOST_CHECK(yy.second==1);
}

/*
for i:0 thru 20 do( block([a,b,c,xlow,xhigh,pp,dd,rr,xx,minv,maxv, hits],
    a:random(2.0)-1,
    b:random(2.0)-1,
    c:random(2.0)-1,
    xlow:-random(2.0),
    xhigh:xlow+random(4.0),
    pp:a*x^2+b*x+c,
    minv:min(subst(x=xlow,pp),subst(x=xhigh,pp)),
    maxv:max(subst(x=xlow,pp),subst(x=xhigh,pp)),
    dd:diff(pp,x),
    rr : float(realroots(dd=0,1e-10)),
    hits:0,
    for j:1 thru length(rr) do(
            xx : subst(rr[j],x),
            if xx>xlow and xx<xhigh then(
                minv : min(minv, subst(x=xx,pp)),
                maxv : max(maxv, subst(x=xx,pp)),
                hits : hits + 1
            )
        
    ),
    print(printf(false,"{~g,~g,~g, ~g,~g, ~g,~g}, // hits=~d",a,b,c, xlow,xhigh, minv,maxv, hits))
    
));
*/
BOOST_AUTO_TEST_CASE(TestDegree2Many)
{
	struct entry{
		double a, b,c;
		double minx, maxx;
		double miny, maxy;
	} aEntries[]={
{-0.52499880698563484,-0.92878455288285711,-0.98773689214156546, -1.9633161772206136,0.84427974071292189, -2.1461143705407491,-0.57695465121286715}, // hits=1
{0.49261591633965018,0.52425191509492164,2.4092140008502572E-2, -1.8375918466207017,-1.2805191451975184, 0.16053426823884864,0.72416883395810072}, // hits=0
{-0.44739667606728828,-0.45612490007486928,-5.0701097756159719E-2, -1.5189312923511209,0.61955840659370542, -0.5050314999755301,6.5554752810898856E-2}, // hits=1
{0.16699765916165932,-0.24343580510946472,5.7199747756326857E-3, -0.20714373384509077,2.07962073692656, -8.2995327442955111E-2,0.22170104502844434}, // hits=1
{-0.19009758191036452,0.41421113306539992,-0.26199418342442726, -1.6185109779649776,2.2218303019267291, -1.4303748521914734,-3.6358932003630495E-2}, // hits=1
{-0.64091375874064083,-0.1208189568260476,-0.39293303533091217, -1.4251740304554343,-1.1971119557954437, -1.522518401192509,-1.1667780065075646}, // hits=0
{0.86378231091512836,-0.17298813666472679,-0.18548758524942732, -0.63266222854398446,2.0018945371988703, -0.19414859134106355,2.9298866238497472}, // hits=1
{-0.26953844708797847,-0.98700198554154017,-0.66788338822825377, -1.4743090577824276,0.40015518127482697, -1.1059969665520035,0.20139726118357071}, // hits=0
{-0.33145212064210883,0.64483830539120435,-0.7456500353275195, -0.99765129176256639,2.646242557369809, -1.7188707841015631,-0.43201767773824257}, // hits=1
{-0.97526822884247455,-0.14378674427047811,-0.43265541622322523, -0.55107772812484201,1.4843096984139961, -2.7947663291883096,-0.4273556875905079}, // hits=1
{-0.80794959971931579,-0.71550430530865095,-0.41664082954595605, -1.0301934845416412,1.5449036928852911, -3.4503815369555291,-0.25823168772168048}, // hits=1
{0.35135434631039075,-0.81354034546458021,-0.81662852358289495, -0.54075132427387684,2.1595651963633213, -1.2875547414088331,-0.27396527917017166}, // hits=1
{-0.58899373260417365,0.98743182702879384,0.92899543956928499, -1.4586495063339764,3.3200412359869258E-2, -1.7644989597788561,0.96112935482491624}, // hits=0
{-0.82392239507241172,7.5997315163105483E-2,0.80466717228203333, -0.73596721104895968,0.90660856388337185, 0.19635296696456683,0.80641964070216066}, // hits=1
{0.60369055091175161,0.38239189325982981,-4.537443317370915E-2, -1.0828970671829956,1.0532590807906455, -0.10592845369382338,1.027090245551022}, // hits=1
{-0.85741061578989308,-0.89358288156005994,-4.5301948178595453E-3, -0.86269966639124407,-0.5528872525903572, 0.12823499566839214,0.22742341355965912}, // hits=0
{-0.56000896085773189,0.266555420456982,0.8915008148374568, -1.9172938640446642,0.42672004282889375, -1.6781660237046745,0.92321985736231782}, // hits=1
{-0.85099851334273247,0.45583384278014227,0.17515620823832245, -1.1737304083540749,-0.49134400565138225, -1.5322420399488017,-0.25426217011552871}, // hits=0
{0.80316526310884617,0.7863198430116789,-0.34741318368543395, -1.4931537098974985,1.2404376180259478, -0.53987011749275382,1.8637862611569194}, // hits=1
{0.89017643702805227,-0.98163389950022051,3.1777000649987563E-2, -0.5444355051460823,2.7840097429135966, -0.23884494365385917,4.1983982940363411}, // hits=1
{-0.12382933368804672,-0.62347650279204947,0.6783411767288805, -0.96107549537571613,1.2673987452727986, -0.31075916725207087,1.1631722068243169} // hits=0"
	};
	const unsigned nEntries=sizeof(aEntries)/sizeof(aEntries[0]);
	
	for(unsigned i=0;i<nEntries;i++){
		const entry &e=aEntries[i];
		std::vector<mpfr::mpreal> coeffs;
		coeffs.push_back(e.c);
		coeffs.push_back(e.b);
		coeffs.push_back(e.a);
		
		std::pair<mpfr::mpreal,mpfr::mpreal> yy=flopoco::random::PolyMinMax(coeffs, mpfr::mpreal(e.minx), mpfr::mpreal(e.maxx));
		
		BOOST_CHECK_CLOSE(yy.first, e.miny, 1e-10);
		BOOST_CHECK_CLOSE(yy.second, e.maxy, 1e-10);
	}
}

/*
for i:0 thru 20 do( block([a,b,c,xlow,xhigh,pp,dd,rr,xx,minv,maxv, hits],
    a:random(2.0)-1,
    b:random(2.0)-1,
    c:random(3.0)-1,
    d:random(3.0)-1,
    xlow:-random(2.0),
    xhigh:xlow+random(4.0),
    pp:a*x^3+b*x^2+c*x+d,
    minv:min(subst(x=xlow,pp),subst(x=xhigh,pp)),
    maxv:max(subst(x=xlow,pp),subst(x=xhigh,pp)),
    dd:diff(pp,x),
    rr : float(realroots(dd=0,1e-10)),
    hits:0,
    for j:1 thru length(rr) do(
            xx : subst(rr[j],x),
            if xx>xlow and xx<xhigh then(
                minv : min(minv, subst(x=xx,pp)),
                maxv : max(maxv, subst(x=xx,pp)),
                hits : hits + 1
            )
        
    ),
    print(printf(false,"{~g,~g,~g, ~g,~g, ~g,~g}, // hits=~d",a,b,c, xlow,xhigh, minv,maxv, hits))
    
));
*/
BOOST_AUTO_TEST_CASE(TestDegree3Many)
{
	struct entry{
		double a, b,c, d;
		double minx, maxx;
		double miny, maxy;
	} aEntries[]={
{0.84637640637065159,-0.23249989771932267,0.85344405351221186,-0.26866755911866669, -1.2847313764059018,1.3979481420564825, -3.5435989260449734,2.7822983005989248}, // hits=0
{-0.32035026958019319,-0.869946466763726,1.9397238276233262,0.48058908826986269, -1.1531533524253845E-3,3.5493900844758324, -17.91903270304504,1.3122760605233224}, // hits=1
{-0.66183335372378505,-0.87052840893486794,1.4902797470789695,1.440887223677584, -0.11056852500702563,0.20995105809119741, 1.2663612627632805,1.7092756684378121}, // hits=0
{-0.59067383419841191,-0.47248240897020244,-0.41279648432677152,0.5841100998533697, -1.7956422878203124,0.55216801239610636, 0.11268207365820616,3.2217563114143326}, // hits=0
{-0.72527746451675856,-0.83024618666710293,0.2612821269464185,0.91880551781560893, -0.80158970463748913,0.6618136986312666, 0.51784185273691175,0.93716434843635177}, // hits=1
{0.49272615683398469,0.88849822834271119,-0.8937680714265146,0.83840746211178852, -0.98839995101127709,2.4925841501955386, 0.65410719686764129,11.761370321708032}, // hits=1
{-0.15368197520789328,-0.52924823709001334,7.4810705916991127E-2,1.2574672030399308, -1.7691182953933322,-1.4259389707364103, 0.31961735993165397,0.52025029171041359}, // hits=0
{0.3039798641019118,0.97165729713059212,1.264730449651847,-0.51410113070502717, -1.9707044051190166,1.7366179031346767, -1.5594423473708465,6.2046704742963579}, // hits=0
{0.72819811082177432,0.55236053745875546,-0.84953341353755074,0.20308705630451129, -0.65319500199430358,2.1587020873214637, -2.3298429579079738E-3,8.2685329159881231}, // hits=1
{-0.76090724821436284,0.20757157830717388,-0.50742029773719333,1.9079425301971495, -1.2068484364866161,1.9408798086546279, -3.8582122426137628,4.1601345008017532}, // hits=0
{-0.30687984358829867,0.8712926616950023,0.12801369262719375,-0.33812315514176428, -1.2916829267724608,-1.0927451371770824, 0.96282257390098869,1.6115846943120999}, // hits=0
{-0.74181182528380196,-6.3890545713322755E-2,1.1668106251832171,1.1780531928392253, -1.489989501060256,-0.15314059769992738, 0.57994038671263803,1.7515000239807739}, // hits=1
{-0.85573844425724088,-5.0472827647727758E-2,3.5486441635948385E-2,0.63188853769952469, -1.5703282384944783,1.8570972862542758, -4.957094208976164,3.7653943966914145}, // hits=2
{-0.99521356177736209,0.25403718008486287,-0.95851150807397101,0.80417399748108975, -1.1665501511891203,-0.7674286854749508, 2.1391889152000982,3.8479183384362194}, // hits=0
{-0.52078504471952636,0.94435861853277236,-0.90906564395961409,1.4356895730449848, -1.5059688550833021,-1.3141930071408563, 5.4434324409822175,6.725180316749098}, // hits=0
{-0.47869633383177268,-0.52065474166565151,1.6755331587524935,-0.53707456966657663, -0.21615567436033434,2.5331792548888563, -7.4150910306248239,0.22592515690608697}, // hits=1
{-0.18547144612772737,-0.27749585851805314,1.9024163441363839,1.717228603483417, -1.0484969351061508,1.651346026987329, -0.36872736384222404,3.3280726229396689}, // hits=1
{0.90170094699496728,0.45973435813264629,0.58204486012633727,1.0961510267108396, -1.9310655064198632,1.7600018417305026, -4.8065816017317111,8.4605141951460148}, // hits=0
{-0.99831998649446652,0.69520468999433183,-0.91558518518199294,1.7534166595095164, -0.51234366452479518,3.455964201691279, -34.315118919698513,2.5392616363076175}, // hits=0
{0.98121244132892027,2.7669973403968928E-2,1.3412066643229261,0.91478249140136403, -1.063111660350041,0.97959531249384701, -1.65875885557541,3.1775402452077479}, // hits=0
{0.78998852600908576,-0.10410353947509599,-0.60624585473595438,0.69833390978142629, -8.7582972198594788E-2,1.0690502480575539, 0.46483863138492887,0.8964451481502661}, // hits=1"
	};
	const unsigned nEntries=sizeof(aEntries)/sizeof(aEntries[0]);
	
	for(unsigned i=0;i<nEntries;i++){
		const entry &e=aEntries[i];
		std::vector<mpfr::mpreal> coeffs;
		coeffs.push_back(e.d);
		coeffs.push_back(e.c);
		coeffs.push_back(e.b);
		coeffs.push_back(e.a);
		
		std::pair<mpfr::mpreal,mpfr::mpreal> yy=flopoco::random::PolyMinMax(coeffs, mpfr::mpreal(e.minx), mpfr::mpreal(e.maxx));
		
		BOOST_CHECK_CLOSE(yy.first, e.miny, 1e-10);
		BOOST_CHECK_CLOSE(yy.second, e.maxy, 1e-10);
	}
}

BOOST_AUTO_TEST_CASE(TestDegree4Many)
{
	struct entry{
		double a, b,c, d, e;
		double minx, maxx;
		double miny, maxy;
	} aEntries[]={
{-0.35636000118743905,0.10874681660994323,0.41477330134395585,0.26399791484793589,0.79930026069881555, -0.70856627822920704,0.57664849271857133, 0.69196969066727398,1.0709048442178613}, // hits=0, roots=[x = 0.99797039970872], deriv=-1.425440004749756*x^3+0.32624044982983*x^2+0.82954660268791*x+0.26399791484794
{-0.64942657368761925,0.94334055495060198,-0.21100532683610318,-0.39770403357936601,0.29762534167552168, -3.8386550837402336,-0.93694647054557656, -195.65257911978358,-0.79137772788465466}, // hits=0, roots=[x = -0.28024532084237], deriv=-2.597706294750477*x^3+2.830021664851806*x^2-0.42201065367221*x-0.39770403357937
{0.82303528280324345,4.8417862568479464E-3,-0.75999815239155888,-0.85230207280801462,-0.30014143455690734, -0.4903474348484087,5.5976630437075814, -1.1421850240463776,780.02798341816037}, // hits=1, roots=[x = 0.86930035284604], deriv=3.292141131212974*x^3+0.014525358770544*x^2-1.519996304783118*x-0.85230207280801
{0.71538351558648872,0.95173059882138933,0.4633828968610656,0.20367232044214179,0.29728348311550024, -3.4920653169825835,3.7064026777582102, 0.22674058824177146,190.881407579729}, // hits=1, roots=[x = -0.67392531465157], deriv=2.861534062345955*x^3+2.855191796464168*x^2+0.92676579372213*x+0.20367232044214
{0.6527371220152367,0.18276800211936939,-0.64322795860058335,0.71577227314914982,3.0651238841780337E-2, -1.970742624180196,4.2129360563226781, -0.85871813421484966,210.92191427582546}, // hits=1, roots=[x = -0.98874536939547], deriv=2.610948488060947*x^3+0.54830400635811*x^2-1.286455917201167*x+0.71577227314915
{-0.80523079265665842,0.29132664136324715,-0.13013324385932723,-0.32465727523480314,-0.45661808626701816, -0.99277562626491456,5.8077054177495375, -865.75444572667232,-0.38347052521038233}, // hits=1, roots=[x = -0.34429224472842], deriv=-3.220923170626634*x^3+0.87397992408974*x^2-0.26026648771865*x-0.3246572752348
{-0.46475506077497997,-0.92526190851079937,-0.93618043792773387,0.83293498680092481,-0.34553348890418567, -3.4721641552966922,1.6397792070478676, -43.342505697094509,-0.20855270744594612}, // hits=1, roots=[x = 0.29281731680385], deriv=-1.85902024309992*x^3-2.775785725532398*x^2-1.872360875855468*x+0.83293498680092
{-0.9057769635091959,0.31930180820677245,0.33625050886995655,0.42220948621567755,0.75916717454471883, -2.1561521382911693,-1.8272470356007648, -21.365287630633379,-10.935066935464299}, // hits=0, roots=[x = 0.73377639389946], deriv=-3.623107854036784*x^3+0.95790542462032*x^2+0.67250101773991*x+0.42220948621568
{-0.62507364833008738,0.55097850997613795,-0.26330253586332208,0.34886319647401454,0.60206274031529805, -3.9537805327696232,-2.3230833551239227, -191.69771353434604,-26.741960757491285}, // hits=0, roots=[x = 0.66154455181095], deriv=-2.50029459332035*x^3+1.652935529928414*x^2-0.52660507172664*x+0.34886319647401
{0.34229436130895419,0.37046657980393638,0.11158192717777471,0.31038209981968334,-0.17146167458951922, -3.8276752915104284,3.249885864371282, -0.40595834926179897,52.974744860702472}, // hits=1, roots=[x = -0.90741751281894], deriv=1.369177445235817*x^3+1.111399739411809*x^2+0.22316385435555*x+0.31038209981968
{0.88609046522859369,-0.78634107163885192,0.4763580600322177,-0.83622724640470425,-0.36303571457155259, -0.27193032782204174,5.1775817894248819, -0.77395310590011901,535.71013820059875}, // hits=1, roots=[x = 0.7359401731228], deriv=3.544361860914375*x^3-2.359023214916556*x^2+0.95271612006444*x-0.8362272464047
{-0.23163019049133959,6.104324584607923E-2,0.13202425358783199,-0.30473892118145551,-0.57783618064353126, -3.3991719826320077,0.55808779693832467, -31.337444526188399,-0.37403524435071267}, // hits=1, roots=[x = -0.75560147370561], deriv=-0.92652076196536*x^3+0.18312973753824*x^2+0.26404850717566*x-0.30473892118146
{-0.45010145396089962,-0.71380402310925817,-0.67797346836077166,-0.49820116346151222,-0.93984225559820844, -0.54705523812881562,6.5432585310646543, -1058.2572369577342,-0.79364571911515536}, // hits=0, roots=[x = -0.68025594818755], deriv=-1.800405815843599*x^3-2.141412069327775*x^2-1.355946936721543*x-0.49820116346151
{-0.96023785267778994,0.71726003657190907,0.89269349868647208,0.58785011430407552,-0.92197052935041368, -3.2694660223959175,3.3626690959932777, -128.08892103660781,0.35373717338023147}, // hits=1, roots=[x = 1.105761993996566], deriv=-3.84095141071116*x^3+2.151780109715727*x^2+1.785386997372944*x+0.58785011430408
{3.6431402322968598E-2,-0.256435804921193,0.8180202378103143,9.0250909598403872E-3,0.78313155280727909, -3.9866622286170328,-0.6579554068085498, 1.2111874806482867,39.199267025097015}, // hits=0, roots=[x = -0.0055021724256221], deriv=0.14572560929187*x^3-0.76930741476358*x^2+1.636040475620629*x+0.0090250909598404
{-0.33508093867787592,-0.16184749959403089,0.87756713319655244,-0.62893396278726188,0.72937444585333555, -1.1714087027377085,2.6088172202062028, -13.333577216208173,2.2995304436656152}, // hits=0, roots=[x = -1.470112746901577], deriv=-1.340323754711504*x^3-0.48554249878209*x^2+1.755134266393105*x-0.62893396278726
{0.83765796909260803,0.37382102963675257,0.11387023576770794,-0.9078610912986087,0.39416822251208083, -2.3704730846171023,0.2842733902367689, 0.15934739697477163,24.655628358924851}, // hits=0, roots=[x = 0.5236434819235], deriv=3.350631876370432*x^3+1.121463088910258*x^2+0.22774047153542*x-0.90786109129861
{0.25725418464743255,0.48321565414423207,0.40767430337257915,-0.91269211362009495,0.63635950745494574, -2.3900488532102004,5.187193525234389, 0.3583802921636508,260.56283191175561}, // hits=1, roots=[x = 0.50458252601675], deriv=1.02901673858973*x^3+1.449646962432696*x^2+0.81534860674516*x-0.91269211362009
{0.27286162650958312,-0.41350595204326535,-0.29624487803654009,0.9768058492648799,-0.24105418522509359, -3.4277728153951355,-0.47148044431079761, -0.88996697789330914,47.253446807555903}, // hits=1, roots=[x = -0.82728013713495], deriv=1.091446506038333*x^3-1.240517856129796*x^2-0.59248975607308*x+0.97680584926488
{0.77066007018277949,-8.776416596080594E-2,-0.92304919455625623,0.3736908926943725,-0.22362362409492587, -2.4809256220482858,1.8014563830753261, -0.75389797015722837,23.703711223342353}, // hits=3, roots=[x = -0.82223671782413,x = 0.21190689425566,x = 0.69574118321179], deriv=3.082640280731118*x^3-0.26329249788242*x^2-1.846098389112513*x+0.37369089269437
{-0.82128870036606783,-0.79663153361939187,0.49855995865879121,9.4421926284604663E-2,0.54386260719412194, -1.5894683535559748,6.3869669284966628, -1552.7782660572295,0.92335023969770857}, // hits=3, roots=[x = -1.001817581680371,x = -0.080788506922545,x = 0.35512298802496], deriv=-3.285154801464271*x^3-2.389894600858176*x^2+0.99711991731758*x+0.094421926284605
{0.91408155241252365,0.3373854126660234,-0.4369607241115725,-0.97060745884510835,-0.80671227522389177, -3.3567727365234985,2.0013919356380567, -1.367500617085313,100.82390246635356}, // hits=1, roots=[x = 0.67038639905513], deriv=3.656326209650095*x^3+1.01215623799807*x^2-0.87392144822314*x-0.97060745884511
{0.34232917068109447,0.49729834923848459,0.67939047609372283,0.23546053324639038,6.9089316663451861E-2, -2.5564746319004241,2.6561198407272686, 4.5658296811208594E-2,31.845008496204194}, // hits=1, roots=[x = -0.2135426888417], deriv=1.369316682724378*x^3+1.491895047715454*x^2+1.358780952187446*x+0.23546053324639
{0.50523586504848161,0.55398598019471113,-0.15012715388105136,-0.70507750742119679,-0.18129358187666833, -0.14305317737792755,4.4375456361421968, -0.47624185747278552,238.05676006099185}, // hits=1, roots=[x = 0.55916717639775], deriv=2.020943460193927*x^3+1.661957940584133*x^2-0.3002543077621*x-0.7050775074212
{0.91121947722673724,0.99141248529011694,0.73328122653141792,-0.53671148480511199,-0.2457545029930932, -0.67318870809918607,4.3601345718966815, -0.31579584979848468,422.85545354177231}, // hits=1, roots=[x = 0.2293306106294], deriv=3.644877908906949*x^3+2.974237455870351*x^2+1.466562453062836*x-0.53671148480511
{-0.83110588703765576,-0.7438334310077348,-0.49186069544417954,0.46838344035417379,0.83305812367948473, -1.1846007255742377,5.7378434678354191, -1054.0348145534042,0.90471843654105388}, // hits=1, roots=[x = 0.26118144174688], deriv=-3.324423548150623*x^3-2.231500293023204*x^2-0.98372139088836*x+0.46838344035417
{0.55414455077393887,-0.55931295779472689,0.35781078038157643,-0.40334157808979354,0.26277400358566005, -3.8793918056316548,-1.4995564483706554, 6.3602529025955867,165.37694237206358}, // hits=0, roots=[x = 0.67709022181225], deriv=2.216578203095756*x^3-1.677938873384181*x^2+0.71562156076315*x-0.40334157808979
{0.33887234000249533,-0.83258534906049197,-0.26201635805559764,0.74730391723917267,0.58543967228989358, -3.9379138587136344,1.5270481732489651, -6.4555159493788761E-3,125.91142057616551}, // hits=2, roots=[x = -0.56543274477008,x = 0.5150531155814,x = 1.89307653324795], deriv=1.355489360009981*x^3-2.497756047181476*x^2-0.5240327161112*x+0.74730391723917
{0.77067521814894535,-0.63358995802977969,-0.75492963169238525,0.51553179331581855,0.68984176350846926, -3.6974890336492123,0.80766575636389248, 0.34487547608398472,164.53590212369448}, // hits=2, roots=[x = -0.61686963928514,x = 0.28619142368552,x = 0.94727059765137], deriv=3.082700872595781*x^3-1.900769874089339*x^2-1.509859263384771*x+0.51553179331582
{0.31527099238980361,0.22250789727829501,-0.68024090215534772,-0.27746981672493209,-0.43233243556998158, -1.1427830729284487,-1.0352365378499861, -0.79798389302922756,-0.75886582003058822}, // hits=0, roots=[x = -1.251068320387276,x = -0.19238957521156,x = 0.91413256278611], deriv=1.261083969559214*x^3+0.66752369183489*x^2-1.360481804310695*x-0.27746981672493
{-0.64513917411570443,-0.9404541582592203,-0.14143817135195214,-0.78292172269504068,-0.35988268068424745, -2.577130383919088,0.32714494685923956, -11.642144662303416,0.66353177647917239}, // hits=1, roots=[x = -1.209955014899606], deriv=-2.580556696462818*x^3-2.821362474777661*x^2-0.2828763427039*x-0.78292172269504
{0.18487440335534266,0.67935843592650524,-0.48110049205605909,-0.37612890119248732,-5.1689049995933711E-2, -1.471407423044103,4.0481393076654149, -1.8374741514483421,85.257016548530117}, // hits=2, roots=[x = -3.120739170553861,x = -0.26063010984217,x = 0.62534239023807], deriv=0.73949761342137*x^3+2.038075307779516*x^2-0.96220098411212*x-0.37612890119249
{1.5823624028426853E-2,-0.86900960053329834,-0.66678139557083371,-6.278506740108325E-2,0.36204683014584393, -2.7422401187363858,-1.1788665388177693, 0.96367921683727897,14.335030009733009}, // hits=0, roots=[x = -0.45342046444421,x = -0.052469607646344,x = 41.69476053750259], deriv=0.063294496113707*x^3-2.607028801599895*x^2-1.333562791141667*x-0.062785067401083
{0.69265418363963516,0.82896064694392724,0.61375977820923122,-0.17720228140069949,-0.57987224097000922, -0.65044646502736558,5.2615186426245435, -0.59075193643245882,667.05998261056016}, // hits=1, roots=[x = 0.11444155164645], deriv=2.770616734558541*x^3+2.486881940831782*x^2+1.227519556418462*x-0.1772022814007
{-0.53293404634835229,0.38531719675243359,-0.86668962156742513,0.44060273158323016,-0.54004069488753492, -2.2015252530167313,-0.43780920498545228, -22.340989013511745,-0.9509800356847059}, // hits=0, roots=[x = 0.27942489829729], deriv=-2.131736185393409*x^3+1.155951590257301*x^2-1.73337924313485*x+0.44060273158323
{9.7699291712058489E-2,0.94266963465486064,-0.7536014145162282,-0.60637034438927806,-0.41487442136174302, -3.7469169043727435,-3.6181554821038908E-2, -39.054582957886666,-0.32412716895252913}, // hits=1, roots=[x = -7.710601720580598,x = -0.27032403313206,x = 0.74441243204637], deriv=0.39079716684823*x^3+2.828008903964582*x^2-1.507202829032456*x-0.60637034438928
{-0.50815532494214244,0.48285433287720325,0.64796288099282995,0.7536714955810897,4.9599117705282136E-2, -3.1336329788540551,-0.48472189409487054, -59.806564970434259,-0.24652314816715978}, // hits=0, roots=[x = 1.373435100395], deriv=-2.03262129976857*x^3+1.44856299863161*x^2+1.29592576198566*x+0.75367149558109
{0.71816972647030664,0.73730243239788518,0.17862461171252209,0.21883346223599354,0.45833389510150635, -2.8965090424536273,4.2507976820679074, 0.31079310362454571,295.72916180958424}, // hits=1, roots=[x = -0.74090280759265], deriv=2.872678905881227*x^3+2.211907297193656*x^2+0.35724922342504*x+0.21883346223599
{-0.89026179777509773,0.90013302560798136,0.59986686957244029,0.96552845243055474,-0.62803350411571701, -0.21880472744198531,-5.6767392976520448E-2, -0.82204654211581929,-0.68108485507235794}, // hits=0, roots=[x = 1.217794270633021], deriv=-3.561047191100391*x^3+2.700399076823944*x^2+1.199733739144881*x+0.96552845243055
{0.85016307789745538,-0.80373733697353389,0.99279339839226921,0.40150582161481552,-0.48810807722213223, -3.8456891961076156,-1.1235345782278792, 2.80865194806031,244.31444345985267}, // hits=0, roots=[x = -0.16269235571963], deriv=3.400652311589822*x^3-2.411212010920602*x^2+1.985586796784538*x+0.40150582161482
{-0.31504565238307469,0.79530397154348798,-9.8102707890449725E-2,0.73154975141989809,-0.29551641800186834, -2.3982490775294272,0.18259783126394336, -24.006428911437592,-0.16071624276820246} // hits=0, roots=[x = 1.964474805368809], deriv=-1.260182609532299*x^3+2.385911914630464*x^2-0.1962054157809*x+0.7315497514199"
};
	const unsigned nEntries=sizeof(aEntries)/sizeof(aEntries[0]);
	
	for(unsigned i=0;i<nEntries;i++){
		const entry &e=aEntries[i];
		std::vector<mpfr::mpreal> coeffs;
		coeffs.push_back(e.e);
		coeffs.push_back(e.d);
		coeffs.push_back(e.c);
		coeffs.push_back(e.b);
		coeffs.push_back(e.a);
		
		std::pair<mpfr::mpreal,mpfr::mpreal> yy=flopoco::random::PolyMinMax(coeffs, mpfr::mpreal(e.minx), mpfr::mpreal(e.maxx));
		
		BOOST_CHECK_CLOSE(yy.first, e.miny, 1e-10);
		BOOST_CHECK_CLOSE(yy.second, e.maxy, 1e-10);
	}
}
